#! /bin/bash

if ! type -P aocd > /dev/null
then
    echo "mkaoc: command not found: aocd"
    exit 1
fi

if [ $# -ne 2 ]
then
    echo "usage: mkaoc YYYY DD"
    exit 1
fi

AOC=~/code/python/aoc
YEAR=$(($1))
DAY=$(($2))
DEST="$AOC/$1/$2"
TEMPLATES=$AOC/extras/templates

python3 -m webbrowser https://adventofcode.com/$YEAR/day/$DAY > /dev/null
mkdir -p $DEST
if [ ! -f $DEST/a.py ]; then
    cp $TEMPLATES/p.py $DEST/a.py;
    sed -i "s/part=\"p\", day=d, year=yyyy/part=\"a\", day=$DAY, year=$YEAR/" $DEST/a.py;
fi
if [ ! -f $DEST/b.py ]; then
    cp $TEMPLATES/p.py $DEST/b.py;
    sed -i "s/part=\"p\", day=d, year=yyyy/part=\"b\", day=$DAY, year=$YEAR/" $DEST/b.py;
fi
if [ ! -f $DEST/test_a.py ]; then
    cp $TEMPLATES/test_p.py $DEST/test_a.py;
    sed -i "s/from p import/from a import/" $DEST/test_a.py;
fi
if [ ! -f $DEST/test_b.py ]; then
    cp $TEMPLATES/test_p.py $DEST/test_b.py;
    sed -i "s/from p import/from b import/" $DEST/test_b.py;
fi
code -r $AOC $DEST/test_a.py $DEST/a.py $DEST/input.txt
if [ ! -f $DEST/input.txt ]; then aocd $DAY $YEAR > $DEST/input.txt; fi
